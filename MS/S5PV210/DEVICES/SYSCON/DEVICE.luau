local module = {}

local CPU = require("../../CPU")

APLL_LOCK = 0xE0100000
MPLL_LOCK = 0xE0180000
EPLL_LOCK = 0xE0100010
VPLL_LOCK = 0xE0100020

APLL_CON0 = 0xE0100100
APLL_CON1 = 0xE0100104
MPLL_CON = 0xE0100108

EPLL_CON0 = 0xE0100110
EPLL_CON1 = 0xE0100114
VPLL_CON = 0xE0100120

CLK_SRC0 = 0xE0100200
CLK_SRC1 = 0xE0100204
CLK_SRC2 = 0xE0100208
CLK_SRC3 = 0xE010020C
CLK_SRC4 = 0xE0100210
CLK_SRC5 = 0xE0100214
CLK_SRC6 = 0xE0100218

CLK_SRC_MASK0 = 0xE0100280
CLK_SRC_MASK1 = 0xE0100284

CLK_DIV0 = 0xE0100300
CLK_DIV1 = 0xE0100304
CLK_DIV2 = 0xE0100308
CLK_DIV3 = 0xE010030C
CLK_DIV4 = 0xE0100310
CLK_DIV5 = 0xE0100314
CLK_DIV6 = 0xE0100318
CLK_DIV7 = 0xE010031C

CLK_GATE_SCLK = 0xE0100444

CLK_GATE_IP0 = 0xE0100460
CLK_GATE_IP1 = 0xE0100464
CLK_GATE_IP2 = 0xE0100468
CLK_GATE_IP3 = 0xE010046C
CLK_GATE_IP4 = 0xE0100470

CLK_GATE_BLOCK = 0xE0100480
CLK_GATE_IP5 = 0xE0100470

CLK_OUT = 0xE0100500

CLK_DIV_STAT0 = 0xE0101000
CLK_DIV_STAT1 = 0xE0101004

CLK_MUX_STAT0 = 0xE0101100
CLK_MUX_STAT1 = 0xE0101104

SWRESET = 0xE0102000

DCGIDX_MAP0 = 0xE0103000
DCGIDX_MAP1 = 0xE0103004
DCGIDX_MAP2 = 0xE0103008

DCGPERF_MAP0 = 0xE0103020
DCGPERF_MAP1 = 0xE0103024

DVCIDX_MAP = 0xE0103040

FREQ_CPU = 0xE0103060
FREQ_DPM = 0xE0103064

DVSEMCLK_EN = 0xE0103080
MAXPERF = 0xE0103085

APLL_CON0_L8 = 0xE0103100
APLL_CON0_L7 = 0xE0103104
APLL_CON0_L6 = 0xE0103108
APLL_CON0_L5 = 0xE010310C
APLL_CON0_L4 = 0xE0103110
APLL_CON0_L3 = 0xE0103114
APLL_CON0_L2 = 0xE0103118
APLL_CON0_L1 = 0xE010311C

CLKDIV_IEM_L8 = 0xE0103200
CLKDIV_IEM_L7 = 0xE0103204
CLKDIV_IEM_L6 = 0xE0103208
CLKDIV_IEM_L5 = 0xE010320C
CLKDIV_IEM_L4 = 0xE0103210
CLKDIV_IEM_L3 = 0xE0103214
CLKDIV_IEM_L2 = 0xE0103218
CLKDIV_IEM_L1 = 0xE010321C

APLL_CON1_L8 = 0xE0103300
APLL_CON1_L7 = 0xE0103304
APLL_CON1_L6 = 0xE0103308
APLL_CON1_L5 = 0xE010330C
APLL_CON1_L4 = 0xE0103310
APLL_CON1_L3 = 0xE0103314
APLL_CON1_L2 = 0xE0103318
APLL_CON1_L1 = 0xE010331C

GENERAL_CTRL = 0xE0106100

DISPLAY_CONTROL = 0xE0107008
AUDIO_ENDIAN = 0xE010700C

-- {ADDRESS, DEFAULTVALUE, R/W ACCESS} = {APLL_LOCK, 0x00000FFF, 1} 0=R 1=RW

local MemoryMap = {
	{APLL_LOCK, 0x00000FFF, 1},
	{MPLL_LOCK, 0x00000FFF, 1},
	{EPLL_LOCK, 0x00000FFF, 1},
	{VPLL_LOCK, 0x00000FFF, 1},
	
	{APLL_CON0, 0x00C80301, 1},
	{APLL_CON1, 0x00000000, 1},
	
	{MPLL_CON, 0x014D0301, 1},
	
	{EPLL_CON0, 0x08850302, 1},
	{EPLL_CON1, 0x00000000, 1},
	
	{VPLL_CON, 0x006C0303, 1},
	
	{CLK_SRC0, 0x00000000, 1},
	{CLK_SRC1, 0x00000000, 1},
	{CLK_SRC2, 0x00000000, 1},
	{CLK_SRC3, 0x00000000, 1},
	{CLK_SRC4, 0x00000000, 1},
	{CLK_SRC5, 0x00000000, 1},
	{CLK_SRC6, 0x00000000, 1},
	
	{CLK_SRC_MASK0, 0xFFFFFFFF, 1},
	{CLK_SRC_MASK1, 0xFFFFFFFF, 1},
	
	{CLK_DIV0, 0x00000000, 1},
	{CLK_DIV1, 0x00000000, 1},
	{CLK_DIV2, 0x00000000, 1},
	{CLK_DIV3, 0x00000000, 1},
	{CLK_DIV4, 0x00000000, 1},
	{CLK_DIV5, 0x00000000, 1},
	{CLK_DIV6, 0x00000000, 1},
	{CLK_DIV7, 0x00000000, 1},
	
	{CLK_GATE_SCLK, 0xFFFFFFFF, 1},
	
	{CLK_GATE_IP0, 0xFFFFFFFF, 1},
	{CLK_GATE_IP1, 0xFFFFFFFF, 1},
	{CLK_GATE_IP2, 0xFFFFFFFF, 1},
	{CLK_GATE_IP3, 0xFFFFFFFF, 1},
	{CLK_GATE_IP4, 0xFFFFFFFF, 1},
	
	{CLK_GATE_BLOCK, 0xFFFFFFFF, 1},
	{CLK_GATE_IP5, 0xFFFFFFFF, 1},
	
	{CLK_OUT, 0x00000000, 1},
	
	{CLK_DIV_STAT0, 0x00000000, 0},
	{CLK_DIV_STAT1, 0x00000000, 0},
	
	{CLK_MUX_STAT0, 0x11111111, 0},
	{CLK_MUX_STAT1, 0x00000000, 0},
	
	{SWRESET, 0x00000000, 1},
	
	{DCGIDX_MAP0, 0xFFFFFFFF, 1},
	{DCGIDX_MAP1, 0xFFFFFFFF, 1},
	{DCGIDX_MAP2, 0xFFFFFFFF, 1},
	
	{DCGPERF_MAP0, 0xFFFFFFFF, 1},
	{DCGPERF_MAP1, 0xFFFFFFFF, 1},
	
	{DVCIDX_MAP, 0x00FFFFFF, 1},
	
	{FREQ_CPU, 0x00000000, 1},
	{FREQ_DPM, 0x00000000, 1},
	
	{DVSEMCLK_EN, 0x00000000, 1},
	{MAXPERF, 0x00000000, 1},
	
	{APLL_CON0_L8, 0x00C80301, 1},
	{APLL_CON0_L7, 0x00C80301, 1},
	{APLL_CON0_L6, 0x00C80301, 1},
	{APLL_CON0_L5, 0x00C80301, 1},
	{APLL_CON0_L4, 0x00C80301, 1},
	{APLL_CON0_L3, 0x00C80301, 1},
	{APLL_CON0_L2, 0x00C80301, 1},
	{APLL_CON0_L1, 0x00C80301, 1},
	
	{CLKDIV_IEM_L8, 0x00000000, 1},
	{CLKDIV_IEM_L7, 0x00000000, 1},
	{CLKDIV_IEM_L6, 0x00000000, 1},
	{CLKDIV_IEM_L5, 0x00000000, 1},
	{CLKDIV_IEM_L4, 0x00000000, 1},
	{CLKDIV_IEM_L3, 0x00000000, 1},
	{CLKDIV_IEM_L2, 0x00000000, 1},
	{CLKDIV_IEM_L1, 0x00000000, 1},
	
	{APLL_CON1_L8, 0x00000000, 1},
	{APLL_CON1_L7, 0x00000000, 1},
	{APLL_CON1_L6, 0x00000000, 1},
	{APLL_CON1_L5, 0x00000000, 1},
	{APLL_CON1_L4, 0x00000000, 1},
	{APLL_CON1_L3, 0x00000000, 1},
	{APLL_CON1_L2, 0x00000000, 1},
	{APLL_CON1_L1, 0x00000000, 1},
	
	{GENERAL_CTRL, 0x00000001, 1},
	
	{DISPLAY_CONTROL, 0x00000000, 1},
	{AUDIO_ENDIAN, 0x00000000, 1},
}

function module.WRITE(ADDRESS, DATA)
	for i=1, #MemoryMap, 1 do
		local Offset = MemoryMap[i][1] - 0xE0100000
		if (ADDRESS == Offset) then
			if (MemoryMap[i][3] == 1) then
				MemoryMap[i][2] = DATA
			else
				CPU.Abort(ADDRESS, 0, 0, 1)
			end
		end
	end
end

function module.READ(ADDRESS) : number
	for i=1, #MemoryMap, 1 do
		local Offset = MemoryMap[i][1] - 0xE0100000
		if (ADDRESS == Offset) then
			return MemoryMap[i][2]
		end
	end
	return 0
end

return module
